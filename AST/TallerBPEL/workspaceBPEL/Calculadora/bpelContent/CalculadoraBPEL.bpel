<!-- CalculadoraBPEL BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Wed Mar 04 10:30:57 CET 2015 -->
<bpel:process name="CalculadoraBPEL"
         targetNamespace="http://CalculadoraBPEL"
         suppressJoinFailure="yes"
         xmlns:tns="http://CalculadoraBPEL"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns="http://Suma" xmlns:ns0="http://Resta">

    <!-- Import the client WSDL -->
    <bpel:import namespace="http://Resta" location="resta.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://Suma" location="suma.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import location="CalculadoraBPELArtifacts.wsdl" namespace="http://CalculadoraBPEL" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:CalculadoraBPEL"
                     myRole="CalculadoraBPELProvider"
                     partnerRole="CalculadoraBPELProvider"/>
        <bpel:partnerLink name="Suma" partnerLinkType="tns:Sumapl" partnerRole="sumaRole"></bpel:partnerLink>
        <bpel:partnerLink name="Resta" partnerLinkType="tns:restapl" partnerRole="restaRole"></bpel:partnerLink>
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:CalculadoraBPELRequestMessage">
            <bpel:from>
                <bpel:literal xml:space="preserve"><tns:CalculadoraBPELRequest xmlns:tns="http://CalculadoraBPEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:seleccion>tns:seleccion</tns:seleccion>
  <tns:dato1>0</tns:dato1>
  <tns:dato2>0</tns:dato2>
</tns:CalculadoraBPELRequest>
</bpel:literal>
            </bpel:from>
        </bpel:variable>
                  
        <!-- 
          Reference to the message that will be returned to the requester
          -->
        <bpel:variable name="output"
                  messageType="tns:CalculadoraBPELResponseMessage"/>
        <bpel:variable name="SumaResponse" messageType="ns:sumaResponse"></bpel:variable>
        <bpel:variable name="SumaRequest" messageType="ns:sumaRequest">
            <bpel:from>
                <bpel:literal xml:space="preserve"><xsd:suma xmlns:xsd="http://Suma" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <xsd:args0>0</xsd:args0>
  <xsd:args1>0</xsd:args1>
</xsd:suma>
</bpel:literal>
            </bpel:from>
        </bpel:variable>
        <bpel:variable name="RestaResponse" messageType="ns0:RestaResponse"></bpel:variable>
        <bpel:variable name="RestaRequest" messageType="ns0:RestaRequest">
            <bpel:from>
                <bpel:literal xml:space="preserve"><xsd:Resta xmlns:xsd="http://Resta" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <xsd:args0>0</xsd:args0>
  <xsd:args1>0</xsd:args1>
</xsd:Resta>
</bpel:literal>
            </bpel:from>
        </bpel:variable>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:sequence name="main">
        
        <!-- Receive input from requester. 
             Note: This maps to operation defined in CalculadoraBPEL.wsdl 
             -->
        <bpel:receive name="receiveInput" partnerLink="client"
                 portType="tns:CalculadoraBPEL"
                 operation="process" variable="input"
                 createInstance="yes"/>
        
        <!-- Generate reply to synchronous request -->
        <bpel:if name="If">
            <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$input.payload/tns:seleccion="suma"]]></bpel:condition>
            <bpel:sequence>
                <bpel:assign validate="no" name="AsignaOperandos">
                    <bpel:copy>
                        <bpel:from><bpel:literal><xsd:suma xmlns:xsd="http://Suma" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <xsd:args0>0</xsd:args0>
  <xsd:args1>0</xsd:args1>
</xsd:suma>
</bpel:literal></bpel:from>
                        <bpel:to variable="SumaRequest" part="parameters"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="payload" variable="input">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[tns:dato1]]>
                            </bpel:query>
                        </bpel:from>
                        <bpel:to part="parameters" variable="SumaRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:args0]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="payload" variable="input">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:dato2]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="parameters" variable="SumaRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:args1]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:invoke name="InvokeSuma" partnerLink="Suma" operation="suma" portType="ns:SumaPortType" inputVariable="SumaRequest" outputVariable="SumaResponse"></bpel:invoke>
                <bpel:assign validate="no" name="AsignaResultados">
                    <bpel:copy>
                        <bpel:from><bpel:literal xml:space="preserve"><tns:CalculadoraBPELResponse xmlns:tns="http://CalculadoraBPEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:operacionCorrecta>Correcto</tns:operacionCorrecta>
  <tns:resultadoOperacion>0</tns:resultadoOperacion>
</tns:CalculadoraBPELResponse></bpel:literal></bpel:from>
                        <bpel:to variable="output" part="payload"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="parameters" variable="SumaResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:return]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="payload" variable="output">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:resultadoOperacion]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                    
                </bpel:assign>
                <bpel:reply name="ReplySuma" partnerLink="client" portType="tns:CalculadoraBPEL" operation="process" variable="output" />
            </bpel:sequence>
        <bpel:elseif>
                <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$input.payload/tns:seleccion="resta"]]></bpel:condition>
                <bpel:sequence>
                    <bpel:assign validate="no" name="AsignaOperandos">
                        <bpel:copy>
                            <bpel:from><bpel:literal><xsd:Resta xmlns:xsd="http://Resta" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <xsd:args0>0</xsd:args0>
  <xsd:args1>0</xsd:args1>
</xsd:Resta>
</bpel:literal></bpel:from>
                            <bpel:to variable="RestaRequest" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="payload" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[tns:dato2]]>
                                </bpel:query>
                            </bpel:from>
                            <bpel:to part="parameters" variable="RestaRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[ns0:args1]]>
                                </bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="payload" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:dato1]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="parameters" variable="RestaRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:args0]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:invoke name="InvokeResta" partnerLink="Resta" operation="Resta" portType="ns0:RestaPortType" inputVariable="RestaRequest" outputVariable="RestaResponse"></bpel:invoke>
                    <bpel:assign validate="no" name="AsignaResultados">
                        <bpel:copy>
                            <bpel:from><bpel:literal xml:space="preserve"><tns:CalculadoraBPELResponse xmlns:tns="http://CalculadoraBPEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:operacionCorrecta>Correcto</tns:operacionCorrecta>
  <tns:resultadoOperacion>0</tns:resultadoOperacion>
</tns:CalculadoraBPELResponse></bpel:literal></bpel:from>
                            <bpel:to variable="output" part="payload"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="RestaResponse">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:return]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:resultadoOperacion]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        
                    </bpel:assign>
                    <bpel:reply name="ReplyResta" partnerLink="client" operation="process" portType="tns:CalculadoraBPEL" variable="output"></bpel:reply>
                </bpel:sequence>
            </bpel:elseif><bpel:else>
                <bpel:sequence>
                    <bpel:assign validate="no" name="AsignaError">
                        
                        <bpel:copy>
                            <bpel:from><bpel:literal xml:space="preserve"><tns:CalculadoraBPELResponse xmlns:tns="http://CalculadoraBPEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:operacionCorrecta>Error</tns:operacionCorrecta>
  <tns:resultadoOperacion>-1</tns:resultadoOperacion>
</tns:CalculadoraBPELResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="output" part="payload"></bpel:to>
                        </bpel:copy>
                        
                    </bpel:assign>
                    <bpel:reply name="ReplyError" partnerLink="client" operation="process" portType="tns:CalculadoraBPEL" variable="output"></bpel:reply>
                </bpel:sequence>
            </bpel:else></bpel:if>
        
    </bpel:sequence>
</bpel:process>

